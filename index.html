<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pamalo Junior School - P9 System Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            .no-print { display: none; }
            body { font-size: 9pt; }
            table { width: 100%; border-collapse: collapse; }
            th, td { border: 1px solid black !important; padding: 2px; }
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* Highlight editable fields slightly differently */
        .editable-input {
            background-color: #fffbeb; /* Light yellow tint */
        }
        .editable-input:focus {
            background-color: #ffffff;
            outline: 2px solid #15803d;
        }
    </style>
</head>
<body class="bg-gray-50 p-2 md:p-8">
    <div class="max-w-7xl mx-auto bg-white p-6 shadow-lg rounded-lg border border-gray-200">
        <!-- Header with Logo and Title Side by Side -->
        <div class="flex flex-row items-center justify-center gap-6 mb-4 border-b-2 border-green-700 pb-4">
            <div class="shrink-0">
                <!-- Integrated School Logo -->
                <div class="w-20 h-20 md:w-24 md:h-24 flex items-center justify-center overflow-hidden">
                    <img src="pamalo-logo.png" alt="Pamalo Junior School Logo" class="object-contain w-full h-full" onerror="this.style.display='none'">
                </div>
            </div>
            <div class="text-left">
                <h1 class="text-xl md:text-2xl font-bold text-green-800 uppercase leading-none">Pamalo Junior School</h1>
                <p class="text-xs text-gray-600 font-semibold mb-1 tracking-widest uppercase">Mtwapa - Kilifi County</p>
                <div class="border-t pt-1">
                    <h2 class="text-base font-semibold text-gray-700 uppercase leading-tight">P9A Tax Deduction Card</h2>
                    <div class="flex items-center gap-4">
                        <p class="text-[10px] font-bold text-gray-500 italic">(Statutory 2025/2026 Format)</p>
                        <p class="text-xs font-medium">Year: <input type="number" value="2025" class="border-b w-12 text-center focus:outline-none font-bold"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compact Info Section -->
        <div class="grid grid-cols-2 gap-x-8 gap-y-1 mb-4 text-[11px]">
            <div class="flex gap-2 items-center">
                <span class="font-bold whitespace-nowrap">Employer Name:</span> 
                <span class="border-b border-gray-300 flex-grow px-1">Pamalo Junior School</span>
            </div>
            <div class="flex gap-2 items-center">
                <span class="font-bold whitespace-nowrap">Employee Name:</span> 
                <input type="text" placeholder="Full Name" class="border-b border-gray-300 w-full focus:outline-none font-semibold px-1">
            </div>
            <div class="flex gap-2 items-center">
                <span class="font-bold whitespace-nowrap">Employer PIN:</span> 
                <input type="text" placeholder="PxxxxxxxxX" class="border-b border-gray-300 w-full focus:outline-none px-1 uppercase">
            </div>
            <div class="flex gap-2 items-center">
                <span class="font-bold whitespace-nowrap">Employee PIN:</span> 
                <input type="text" placeholder="AxxxxxxxxX" class="border-b border-gray-300 w-full focus:outline-none font-semibold px-1 uppercase">
            </div>
        </div>

        <!-- Table -->
        <div class="overflow-x-auto">
            <table class="w-full text-[10px] text-left border-collapse border border-gray-300">
                <thead class="bg-gray-100 text-center uppercase">
                    <tr>
                        <th class="border p-1" rowspan="2">Month</th>
                        <th class="border p-1" rowspan="2">Basic Pay</th>
                        <th class="border p-1" rowspan="2">Benefits</th>
                        <th class="border p-1" rowspan="2">Quarters</th>
                        <th class="border p-1 bg-green-50" rowspan="2">Gross (D)</th>
                        <th class="border p-1" colspan="3">Statutory Deductions (Tax Exempt)</th>
                        <th class="border p-1 bg-blue-50" rowspan="2">Taxable Pay (K)</th>
                        <th class="border p-1" rowspan="2">Tax Charged</th>
                        <th class="border p-1 text-red-600" rowspan="2">Pers. Relief</th>
                        <th class="border p-1" rowspan="2">Ins. Relief</th>
                        <th class="border p-1 font-bold" rowspan="2">PAYE (O)</th>
                    </tr>
                    <tr class="bg-gray-50">
                        <th class="border p-1">NSSF (6%)</th>
                        <th class="border p-1">SHIF (2.75%)</th>
                        <th class="border p-1">AHL (1.5%)</th>
                    </tr>
                </thead>
                <tbody id="p9-body">
                    <!-- JS populate -->
                </tbody>
                <tfoot class="bg-gray-200 font-bold">
                    <tr id="totals-row">
                        <td class="border p-1 uppercase">Totals</td>
                        <td class="border p-1 text-right" id="total-basic">0</td>
                        <td class="border p-1 text-right" id="total-benefits">0</td>
                        <td class="border p-1 text-right" id="total-quarters">0</td>
                        <td class="border p-1 text-right" id="total-gross">0</td>
                        <td class="border p-1 text-right" id="total-nssf">0</td>
                        <td class="border p-1 text-right" id="total-shif">0</td>
                        <td class="border p-1 text-right" id="total-ahl">0</td>
                        <td class="border p-1 text-right" id="total-taxable">0</td>
                        <td class="border p-1 text-right" id="total-charged">0</td>
                        <td class="border p-1 text-center">28,800</td>
                        <td class="border p-1 text-right" id="total-ins">0</td>
                        <td class="border p-1 text-right" id="total-paye">0</td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded text-xs no-print">
            <h3 class="font-bold text-blue-800 mb-1 italic underline">Instruction Note:</h3>
            <p>Enter the <strong>Basic Pay</strong> and any <strong>Benefits/Allowances</strong> for each month. The system will automatically calculate:</p>
            <ul class="list-disc ml-5 mt-1">
                <li><strong>NSSF:</strong> Tier I & II (6% capped at Ksh 4,320).</li>
                <li><strong>SHIF:</strong> 2.75% of Gross (min Ksh 300).</li>
                <li><strong>Housing Levy:</strong> 1.5% of Gross.</li>
                <li><strong>Taxable Pay:</strong> Gross minus (NSSF + SHIF + AHL).</li>
            </ul>
        </div>

        <!-- Bottom Certification -->
        <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8 text-sm">
            <div>
                <p class="italic mb-4 text-xs">I certify that the particulars entered above are correct in every respect.</p>
                <div class="mt-4">
                    <p class="mb-8 font-bold">Authorized Signature: _________________________</p>
                    <p class="font-bold">Date: _________________________</p>
                </div>
            </div>
            <div class="flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg p-4">
                <p class="text-gray-400">Official School Stamp Area</p>
            </div>
        </div>

        <div class="mt-6 no-print flex justify-end gap-2">
            <button onclick="window.print()" class="bg-green-700 text-white px-6 py-2 rounded hover:bg-green-800 font-bold shadow-md">Print P9 Form</button>
        </div>
    </div>

    <script>
        const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        const p9Body = document.getElementById('p9-body');

        // Initial Calculation Suggestion
        function suggestDeductions(idx) {
            const basic = parseFloat(document.getElementById(`basic-${idx}`).value) || 0;
            const benefits = parseFloat(document.getElementById(`ben-${idx}`).value) || 0;
            const quarters = parseFloat(document.getElementById(`qtr-${idx}`).value) || 0;
            const gross = basic + benefits + quarters;

            if (gross > 0) {
                // Statutory NSSF (6% capped at 2160 or 4320 based on Tier II 2025/26 guidelines)
                // Defaulting to Tier II cap for school payroll
                const nssfSug = Math.min(gross * 0.06, 4320);
                document.getElementById(`nssf-${idx}`).value = Math.round(nssfSug);

                // Statutory Housing Levy (1.5% - No Cap)
                const ahlSug = gross * 0.015;
                document.getElementById(`ahl-${idx}`).value = Math.round(ahlSug);
            }
            calculateRow(idx);
        }

        function calculateRow(idx) {
            const basic = parseFloat(document.getElementById(`basic-${idx}`).value) || 0;
            const benefits = parseFloat(document.getElementById(`ben-${idx}`).value) || 0;
            const quarters = parseFloat(document.getElementById(`qtr-${idx}`).value) || 0;
            const insRelief = parseFloat(document.getElementById(`ins-${idx}`).value) || 0;
            
            // 1. Gross
            const gross = basic + benefits + quarters;
            document.getElementById(`gross-val-${idx}`).innerText = gross.toLocaleString();

            // 2. Read (potentially edited) statutory values
            const nssf = parseFloat(document.getElementById(`nssf-${idx}`).value) || 0;
            const ahl = parseFloat(document.getElementById(`ahl-${idx}`).value) || 0;

            // 3. SHIF (Auto 2.75% of Gross, min 300 if gross > 0)
            let shif = 0;
            if (gross > 0) {
                shif = Math.max(300, Math.round(gross * 0.0275));
            }
            document.getElementById(`shif-val-${idx}`).innerText = shif.toFixed(0);

            // 4. Taxable Pay (Gross minus Exempt Deductions)
            const taxable = Math.max(0, gross - nssf - shif - ahl);
            document.getElementById(`taxable-val-${idx}`).innerText = taxable.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0});

            // 5. Tax Bands (2025 Standard)
            let taxCharged = 0;
            let remaining = taxable;
            if (remaining > 24000) {
                taxCharged += (24000 * 0.10);
                remaining -= 24000;
                if (remaining > 8333) {
                    taxCharged += (8333 * 0.25);
                    remaining -= 8333;
                    if (remaining > 467667) {
                        taxCharged += (467667 * 0.30);
                        remaining -= 467667;
                        if (remaining > 300000) {
                            taxCharged += (300000 * 0.325);
                            remaining -= 300000;
                            taxCharged += (remaining * 0.35);
                        } else { taxCharged += (remaining * 0.325); }
                    } else { taxCharged += (remaining * 0.30); }
                } else { taxCharged += (remaining * 0.25); }
            } else { taxCharged = remaining * 0.10; }
            
            document.getElementById(`charged-val-${idx}`).innerText = Math.round(taxCharged).toLocaleString();
            
            // 6. PAYE (Less Personal Relief of 2400)
            const paye = Math.max(0, taxCharged - 2400 - insRelief);
            document.getElementById(`paye-val-${idx}`).innerText = Math.round(paye).toLocaleString();

            updateTotals();
        }

        function updateTotals() {
            let sums = { basic:0, ben:0, qtr:0, gross:0, nssf:0, shif:0, ahl:0, taxable:0, charged:0, ins:0, paye:0 };
            for(let i=0; i<12; i++) {
                sums.basic += parseFloat(document.getElementById(`basic-${i}`).value) || 0;
                sums.ben += parseFloat(document.getElementById(`ben-${i}`).value) || 0;
                sums.qtr += parseFloat(document.getElementById(`qtr-${i}`).value) || 0;
                sums.nssf += parseFloat(document.getElementById(`nssf-${i}`).value) || 0;
                sums.ahl += parseFloat(document.getElementById(`ahl-${i}`).value) || 0;
                sums.ins += parseFloat(document.getElementById(`ins-${i}`).value) || 0;
                
                sums.shif += parseFloat(document.getElementById(`shif-val-${i}`).innerText.replace(/,/g,'')) || 0;
                sums.gross += parseFloat(document.getElementById(`gross-val-${i}`).innerText.replace(/,/g,'')) || 0;
                sums.taxable += parseFloat(document.getElementById(`taxable-val-${i}`).innerText.replace(/,/g,'')) || 0;
                sums.charged += parseFloat(document.getElementById(`charged-val-${i}`).innerText.replace(/,/g,'')) || 0;
                sums.paye += parseFloat(document.getElementById(`paye-val-${i}`).innerText.replace(/,/g,'')) || 0;
            }
            document.getElementById('total-basic').innerText = sums.basic.toLocaleString();
            document.getElementById('total-benefits').innerText = sums.ben.toLocaleString();
            document.getElementById('total-quarters').innerText = sums.qtr.toLocaleString();
            document.getElementById('total-gross').innerText = sums.gross.toLocaleString();
            document.getElementById('total-nssf').innerText = sums.nssf.toLocaleString();
            document.getElementById('total-shif').innerText = sums.shif.toLocaleString();
            document.getElementById('total-ahl').innerText = sums.ahl.toLocaleString();
            document.getElementById('total-taxable').innerText = sums.taxable.toLocaleString();
            document.getElementById('total-charged').innerText = sums.charged.toLocaleString();
            document.getElementById('total-ins').innerText = sums.ins.toLocaleString();
            document.getElementById('total-paye').innerText = sums.paye.toLocaleString();
        }

        months.forEach((m, i) => {
            const row = `
                <tr>
                    <td class="border p-1 font-bold">${m}</td>
                    <td class="border p-1"><input id="basic-${i}" type="number" class="w-full text-right outline-none editable-input" oninput="suggestDeductions(${i})"></td>
                    <td class="border p-1"><input id="ben-${i}" type="number" class="w-full text-right outline-none" oninput="suggestDeductions(${i})"></td>
                    <td class="border p-1"><input id="qtr-${i}" type="number" class="w-full text-right outline-none" oninput="calculateRow(${i})"></td>
                    <td class="border p-1 bg-green-50 text-right font-bold" id="gross-val-${i}">0</td>
                    <td class="border p-1"><input id="nssf-${i}" type="number" class="w-full text-right outline-none editable-input font-bold text-blue-800" oninput="calculateRow(${i})"></td>
                    <td class="border p-1 text-right" id="shif-val-${i}">0</td>
                    <td class="border p-1"><input id="ahl-${i}" type="number" class="w-full text-right outline-none editable-input font-bold text-blue-800" oninput="calculateRow(${i})"></td>
                    <td class="border p-1 bg-blue-50 text-right font-bold" id="taxable-val-${i}">0</td>
                    <td class="border p-1 text-right" id="charged-val-${i}">0</td>
                    <td class="border p-1 text-center text-red-600">2,400</td>
                    <td class="border p-1"><input id="ins-${i}" type="number" class="w-full text-right outline-none" oninput="calculateRow(${i})"></td>
                    <td class="border p-1 font-bold text-right" id="paye-val-${i}">0</td>
                </tr>
            `;
            p9Body.innerHTML += row;
        });
    </script>
</body>
</html>
